{"lang":"Javascript","fullPath":"/Global_Objects/FinalizationRegistry","category":"Global_Objects","title":"FinalizationRegistry","url":"/en-US/docs/Web/JavaScript/Reference/Global_Objects/FinalizationRegistry","markdown":"# FinalizationRegistry\n\nA **`FinalizationRegistry`** object lets you request a callback when a value is garbage-collected.\n\n## [Description](#description)\n\n`FinalizationRegistry` provides a way to request that a _cleanup callback_ get called at some point when a value registered with the registry has been _reclaimed_ (garbage-collected). (Cleanup callbacks are sometimes called _finalizers_.)\n\n**Note:** Cleanup callbacks should not be used for essential program logic. See [Notes on cleanup callbacks](#notes%5Fon%5Fcleanup%5Fcallbacks) for details.\n\nYou create the registry passing in the callback:\n\n```\nconst registry = new FinalizationRegistry((heldValue) => {\n  // …\n});\n\n```\n\nThen you register any value you want a cleanup callback for by calling the `register` method, passing in the value and a _held value_ for it:\n\n```\nregistry.register(target, \"some value\");\n\n```\n\nThe registry does not keep a strong reference to the value, as that would defeat the purpose (if the registry held it strongly, the value would never be reclaimed). In JavaScript, objects and [non-registered symbols](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/Symbol#shared%5Fsymbols%5Fin%5Fthe%5Fglobal%5Fsymbol%5Fregistry) are garbage collectable, so they can be registered in a `FinalizationRegistry` object as the target or the token.\n\nIf `target` is reclaimed, your cleanup callback may be called at some point with the _held value_ you provided for it (`\"some value\"` in the above). The held value can be any value you like: a primitive or an object, even `undefined`. If the held value is an object, the registry keeps a _strong_ reference to it (so it can pass it to your cleanup callback later).\n\nIf you might want to unregister a registered target value later, you pass a third value, which is the _unregistration token_ you'll use later when calling the registry's `unregister` function to unregister the value. The registry only keeps a weak reference to the unregister token.\n\nIt's common to use the target value itself as the unregister token, which is just fine:\n\n```\nregistry.register(target, \"some value\", target);\n// …\n\n// some time later, if you don't care about `target` anymore, unregister it\nregistry.unregister(target);\n\n```\n\nIt doesn't have to be the same value, though; it can be a different one:\n\n```\nregistry.register(target, \"some value\", token);\n// …\n\n// some time later\nregistry.unregister(token);\n\n```\n\n### [Avoid where possible](#avoid%5Fwhere%5Fpossible)\n\nCorrect use of `FinalizationRegistry` takes careful thought, and it's best avoided if possible. It's also important to avoid relying on any specific behaviors not guaranteed by the specification. When, how, and whether garbage collection occurs is down to the implementation of any given JavaScript engine. Any behavior you observe in one engine may be different in another engine, in another version of the same engine, or even in a slightly different situation with the same version of the same engine. Garbage collection is a hard problem that JavaScript engine implementers are constantly refining and improving their solutions to.\n\nHere are some specific points that the authors of the WeakRef proposal that FinalizationRegistry is part of included in its [explainer document](https://github.com/tc39/proposal-weakrefs/blob/master/reference.md):\n\n> [Garbage collectors](https://en.wikipedia.org/wiki/Garbage%5Fcollection%5F%28computer%5Fscience%29) are complicated. If an application or library depends on GC cleaning up a FinalizationRegistry or calling a finalizer \\[cleanup callback\\] in a timely, predictable manner, it's likely to be disappointed: the cleanup may happen much later than expected, or not at all. Sources of variability include:\n> \n> * One object might be garbage-collected much sooner than another object, even if they become unreachable at the same time, e.g., due to generational collection.\n> * Garbage collection work can be split up over time using incremental and concurrent techniques.\n> * Various runtime heuristics can be used to balance memory usage, responsiveness.\n> * The JavaScript engine may hold references to things which look like they are unreachable (e.g., in closures, or inline caches).\n> * Different JavaScript engines may do these things differently, or the same engine may change its algorithms across versions.\n> * Complex factors may lead to objects being held alive for unexpected amounts of time, such as use with certain APIs.\n\n### [Notes on cleanup callbacks](#notes%5Fon%5Fcleanup%5Fcallbacks)\n\n* Developers shouldn't rely on cleanup callbacks for essential program logic. Cleanup callbacks may be useful for reducing memory usage across the course of a program, but are unlikely to be useful otherwise.\n* A conforming JavaScript implementation, even one that does garbage collection, is not required to call cleanup callbacks. When and whether it does so is entirely down to the implementation of the JavaScript engine. When a registered object is reclaimed, any cleanup callbacks for it may be called then, or some time later, or not at all.\n* It's likely that major implementations will call cleanup callbacks at some point during execution, but those calls may be substantially after the related object was reclaimed.\n* There are also situations where even implementations that normally call cleanup callbacks are unlikely to call them:  \n   * When the JavaScript program shuts down entirely (for instance, closing a tab in a browser).  \n   * When the `FinalizationRegistry` instance itself is no longer reachable by JavaScript code.\n\n## [Constructor](#constructor)\n\n[FinalizationRegistry()](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/FinalizationRegistry/FinalizationRegistry)\n\nCreates a new `FinalizationRegistry` object.\n\n## [Instance properties](#instance%5Fproperties)\n\nThese properties are defined on `FinalizationRegistry.prototype` and shared by all `FinalizationRegistry` instances.\n\n[FinalizationRegistry.prototype.constructor](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/Object/constructor)\n\nThe constructor function that created the instance object. For `FinalizationRegistry` instances, the initial value is the [FinalizationRegistry](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/FinalizationRegistry/FinalizationRegistry) constructor.\n\n`FinalizationRegistry.prototype[@@toStringTag]`\n\nThe initial value of the [@@toStringTag](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/Symbol/toStringTag) property is the string `\"FinalizationRegistry\"`. This property is used in [Object.prototype.toString()](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/Object/toString).\n\n## [Instance methods](#instance%5Fmethods)\n\n[FinalizationRegistry.prototype.register()](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/FinalizationRegistry/register)\n\nRegisters an object with the registry in order to get a cleanup callback when/if the object is garbage-collected.\n\n[FinalizationRegistry.prototype.unregister()](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/FinalizationRegistry/unregister)\n\nUnregisters an object from the registry.\n\n## [Examples](#examples)\n\n### [Creating a new registry](#creating%5Fa%5Fnew%5Fregistry)\n\nYou create the registry passing in the callback:\n\n```\nconst registry = new FinalizationRegistry((heldValue) => {\n  // …\n});\n\n```\n\n### [Registering objects for cleanup](#registering%5Fobjects%5Ffor%5Fcleanup)\n\nThen you register any objects you want a cleanup callback for by calling the `register` method, passing in the object and a _held value_ for it:\n\n```\nregistry.register(theObject, \"some value\");\n\n```\n\n## [Specifications](#specifications)\n\n| Specification                                                                                                                                                       |\n| ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n| [ECMAScript Language Specification  \\# sec-finalization-registry-objects](https://tc39.es/ecma262/multipage/managing-memory.html#sec-finalization-registry-objects) |\n\n## [Browser compatibility](#browser%5Fcompatibility)\n\nBCD tables only load in the browser\n\n## [See also](#see%5Falso)\n\n* [WeakRef](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/WeakRef)\n* [WeakSet](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/WeakSet)\n* [WeakMap](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/WeakMap)\n\n### Found a content problem with this page?\n\n* [Edit the page on GitHub](https://github.com/mdn/content/edit/main/files/en-us/web/javascript/reference/global%5Fobjects/finalizationregistry/index.md \"This will take you to GitHub, where you'll need to sign in first.\").\n* [Report the content issue](https://github.com/mdn/content/issues/new?template=page-report.yml&mdn-url=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal%5FObjects%2FFinalizationRegistry&metadata=%3C%21--+Do+not+make+changes+below+this+line+--%3E%0A%3Cdetails%3E%0A%3Csummary%3EPage+report+details%3C%2Fsummary%3E%0A%0A%2A+Folder%3A+%60en-us%2Fweb%2Fjavascript%2Freference%2Fglobal%5Fobjects%2Ffinalizationregistry%60%0A%2A+MDN+URL%3A+https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal%5FObjects%2FFinalizationRegistry%0A%2A+GitHub+URL%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fblob%2Fmain%2Ffiles%2Fen-us%2Fweb%2Fjavascript%2Freference%2Fglobal%5Fobjects%2Ffinalizationregistry%2Findex.md%0A%2A+Last+commit%3A+https%3A%2F%2Fgithub.com%2Fmdn%2Fcontent%2Fcommit%2F7da0dabee277f9c295178ae132c16c8fed5d747a%0A%2A+Document+last+modified%3A+2023-03-29T16%3A29%3A26.000Z%0A%0A%3C%2Fdetails%3E \"This will take you to GitHub to file a new issue.\").\n* [View the source on GitHub](https://github.com/mdn/content/blob/main/files/en-us/web/javascript/reference/global%5Fobjects/finalizationregistry/index.md?plain=1 \"Folder: en-us/web/javascript/reference/global_objects/finalizationregistry (Opens in a new tab)\").\nWant to get more involved? [Learn how to contribute](https://github.com/mdn/content/blob/main/CONTRIBUTING.md \"This will take you to our contribution guidelines on GitHub.\").\n\nThis page was last modified on Mar 29, 2023 by [MDN contributors](/en-US/docs/Web/JavaScript/Reference/Global%5FObjects/FinalizationRegistry/contributors.txt)."}